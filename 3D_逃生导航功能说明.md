# 3D逃生导航功能说明

## 功能概述

当用户在地震预警应用中点击地震卡片上的"逃生导航"按钮后，地图将自动切换到3D模式，提供更直观的导航体验。

## 主要功能特点

### 1. 自动3D模式切换
- 当逃生导航激活时，地图自动从2D模式切换到3D模式
- 设置45度倾斜角度，提供最佳的3D视角
- 导航结束后自动切换回2D模式

### 2. 增强的3D视觉效果
- **安全地点标记**：3D模式下标记更大更明显
  - 选中地点：20f内圆，36f外圈
  - 普通地点：16f内圈，28f外圈
  - 添加白色3D效果层，增强立体感

- **导航路线**：3D模式下路线更粗更亮
  - 线宽从8f增加到12f
  - 使用更亮的蓝色 (0, 150, 255)
  - 详细路径添加白色中心线效果

### 3. 3D模式指示器
- 右上角显示"3D导航"或"3D地图"状态指示
- 导航中显示绿色，普通3D模式显示蓝色
- 带有导航图标或地形图标

### 4. 优化的3D视角
- 自动调整相机角度以最佳展示导航路线
- 特殊的内边距设置 (150, 200, 150, 400)
- 同时显示起点和终点的最佳角度

## 技术实现

### 高德地图3D功能集成
基于高德地图官方3D地图教程实现：
- 使用 `setMapType(2)` 切换到卫星地图
- 通过 `setCameraTilt()` 设置倾斜角度
- 通过 `setCameraBearing()` 设置旋转角度

### 核心组件

#### AMapCompose.kt
- 添加3D地图参数：`is3DMode`, `pitch`, `rotation`
- 提供 `switchMapTo3D()` 和 `switchMapTo2D()` 函数
- 支持旋转和倾斜手势控制

#### EarthquakeAMap.kt
- 3D状态管理：`is3DMode`, `mapPitch`, `mapRotation`
- 逃生导航状态监听，自动切换3D模式
- 3D模式指示器UI组件

#### SafetyLocationMarkers.kt
- 支持3D模式的安全地点标记增强
- 3D模式下的导航路线增强效果
- 添加立体感的白色效果层

## 使用流程

1. **激活逃生导航**
   - 用户点击地震卡片上的"逃生导航"按钮
   - 地图自动切换到3D模式 (45度倾斜)

2. **选择安全地点**
   - 在3D模式下浏览附近安全地点
   - 选中的地点显示增强的3D标记效果

3. **开始导航**
   - 点击"开始导航"按钮
   - 显示3D导航路线和"3D导航"指示器
   - 相机自动调整到最佳3D视角

4. **导航结束**
   - 点击"停止导航"或关闭逃生导航
   - 地图自动切换回2D模式

## 视觉体验优势

### 3D模式的优势
- **更直观的空间感**：用户可以更好地理解地形和建筑布局
- **增强的导航体验**：3D视角让路线规划更清晰
- **提升应急响应效率**：在紧急情况下快速理解周围环境

### 设计细节
- **渐进式增强**：从2D平面到3D立体的平滑过渡
- **视觉层次**：不同大小和透明度的标记层次分明
- **色彩系统**：导航状态用绿色，普通3D用蓝色
- **动画效果**：平滑的模式切换和相机移动

## 兼容性说明

- 支持高德地图SDK的3D功能
- 兼容Android系统的OpenGL ES渲染
- 自动降级：如果设备不支持3D，会保持2D模式
- 使用反射机制确保代码兼容性

## 未来扩展

- **地形图支持**：开启 `terrain: true` 显示真实地形
- **建筑物3D模型**：显示周围建筑物的立体模型
- **动态视角**：根据导航进度动态调整3D视角
- **AR集成**：结合增强现实技术的导航指引 